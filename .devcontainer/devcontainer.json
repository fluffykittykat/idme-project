{
  "name": "Python 3",
  "image": "mcr.microsoft.com/devcontainers/python:1-3.12-bullseye",

  // Expose your app, unchanged
  // "runArgs": ["-p", "5001:5000"],

  // Add official Features so 'aws' and 'docker' exist inside the container
  "features": {
    "ghcr.io/devcontainers/features/aws-cli:1.1.2": {},
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1.6.4": {}
  },

  // Mount your code and your AWS credentials; mount Docker socket to reach host engine
  "mounts": [
    "source=C:/Users/DJ/workspace/idme,target=/workspace,type=bind,consistency=cached",

    // Profiles & config: visible but immutable inside the container
    "source=C:/Users/DJ/.aws,target=/home/vscode/.aws,type=bind,consistency=cached"

    // SSO token cache: writable so `aws sso login` can rotate tokens
    // "source=C:/Users/DJ/.aws-sso-cache,target=/home/vscode/.aws/sso,type=bind,consistency=cached",

     // CLI credential cache: READ-WRITE
    // "source=C:/Users/DJ/.aws-cli-cache,target=/home/vscode/.aws/cli/cache,type=bind,consistency=cached"
  ],

  // Ensure weâ€™re the standard user in these images
  "remoteUser": "vscode",

  // Make the profile/region available to shell processes in the container
  "containerEnv": {
    "PORT": "5001",
    "AWS_PROFILE": "bond-admin",
    "AWS_REGION": "us-west-2"
  },
  
  "forwardPorts": [5001],

  "workspaceFolder": "/workspace",

  "postCreateCommand": "bash -lc 'set -e; python -m pip install --upgrade pip; if [ -f requirements.txt ]; then python -m pip install -r requirements.txt; else echo \"No requirements.txt; skipping.\"; fi'",

  "postStartCommand": "bash -lc 'mkdir -p ~/.aws/sso/cache ~/.aws/cli/cache; echo Dev container started on PORT=$PORT'",

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "saoudrizwan.claude-dev"
      ]
    }
  }
}
